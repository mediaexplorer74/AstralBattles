<UserControl x:Class="AstralBattles.Controls.CardsBook"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ViewModels="using:AstralBattles.ViewModels"
    xmlns:Converters="using:AstralBattles.Converters"
    xmlns:Controls="using:AstralBattles.Controls" mc:Ignorable="d"

    Foreground="White" x:Name="thisControl"
    Height="Auto" Width="Auto">

    <UserControl.Resources>

        <Converters:ElementsImageConverter x:Key="elementImageConverter"/>
        <Converters:CardImageConverter x:Key="cardImageConverter"/>
        <Converters:BindToElementConverter x:Key="bindToElementConverter" />
        <Converters:IsActiveToOpacityConverter x:Key="isActiveToOpacityConverter" />
        <Converters:NullToHiddenConverter x:Key="nullToHiddenConverter" />
        <Converters:TrueToVisibleConverter x:Key="trueToVisibleConverter" />
        <Converters:IsCreatureToVisible x:Key="isCreatureToVisible" />
        <Converters:FalseToVisibleConverter x:Key="falseToVisibleConverter" />

        <DataTemplate x:Key="ElementDataTemplate">
            <Controls:ElementInfo Element="{Binding}"></Controls:ElementInfo>
        </DataTemplate>

        <DataTemplate x:Key="CardInBookDataTemplate">
            <Grid Margin="1.5">
                <Grid VerticalAlignment="Center" HorizontalAlignment="Center" Width="80" Height="80">
                    <Image Margin="3"
        				   Source="{Binding Converter={StaticResource cardImageConverter}}" />


                    <Border Visibility="{Binding IsFake, Converter={StaticResource falseToVisibleConverter}}" 
                            VerticalAlignment="Top" HorizontalAlignment="Left" Background="#97494949" 
                            Margin="3,3,3,3" Height="19" Width="22" CornerRadius="0,0,5,0">
                        <TextBlock Text="{Binding Cost}" Margin="2,-3,2,0" 
								   VerticalAlignment="Center" HorizontalAlignment="Center" 
								   FontSize="17" Foreground="White"></TextBlock>
                    </Border>

                    <Border VerticalAlignment="Bottom" HorizontalAlignment="Left" 
                            Background="#97494949" Margin="3,3,3,3" Height="19"
                            Width="22" CornerRadius="0,5,0,0"
                            Visibility="{Binding ., Converter={StaticResource isCreatureToVisible}}">
                        <TextBlock Text="{Binding DamageString}" Margin="2,-3,2,0" 
								   VerticalAlignment="Center" HorizontalAlignment="Center" 
								   FontSize="17" Foreground="#FFFFF9CF"></TextBlock>
                    </Border>

                    <Border VerticalAlignment="Bottom" HorizontalAlignment="Right" Background="#97494949" 
                            Margin="3,3,3,3" Height="19" Width="22" CornerRadius="5,0,0,0"
                            Visibility="{Binding ., Converter={StaticResource isCreatureToVisible}}">
                        <TextBlock Text="{Binding Health}" Margin="2,-3,2,0" 
								   VerticalAlignment="Center" HorizontalAlignment="Center" 
								   FontSize="17" Foreground="#FF9DFF71"></TextBlock>
                    </Border>

                    <Border x:Name="cardInBookBorder" Margin="3" Opacity="{Binding IsActive, Converter={StaticResource isActiveToOpacityConverter}}" Background="#5E5E5E"/>

                    <Rectangle x:Name="rootRectangle" Stroke ="White" StrokeThickness ="2" 
                            StrokeDashArray="0.5,2" StrokeDashCap="Square"
                            Visibility="{Binding IsSelected, Converter={StaticResource trueToVisibleConverter}}">
                        <Rectangle.Triggers>
                            <EventTrigger RoutedEvent="Rectangle.Loaded">
                                <EventTrigger.Actions >
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation 
                                                 Storyboard.TargetName="rootRectangle"
                                                 Storyboard.TargetProperty="StrokeDashOffset"
                                                 To="20" Duration="0:0:30"
                                                 RepeatBehavior="Forever" />
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger.Actions>
                            </EventTrigger>
                        </Rectangle.Triggers>
                    </Rectangle>

                </Grid>
            </Grid>
        </DataTemplate>

    </UserControl.Resources>
    
    <Grid x:Name="LayoutRoot">

        <Grid x:Name="CardsPanelLayoutRoot" 
 
              Height="170" 
              VerticalAlignment="Bottom" 
              HorizontalAlignment="Left" 
              Width="491" 
              Margin="0,0,3,0" >
            <!--491 for 8, 408 for 6-->
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="154" />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <ListBox x:Name="listBox" ItemsSource="{Binding Player.Elements}"
                     ScrollViewer.VerticalScrollBarVisibility="Disabled"
                 SelectedItem="{Binding BattlefieldViewModel.FirstPlayerSelectedElement, Mode=TwoWay}"
                 ItemTemplate="{StaticResource ElementDataTemplate}"
                 SelectionChanged="ListBoxSelectionChanged"/>
            <Grid Grid.Column="1" Background="#002F0D00" Margin="0,0,5,0">
                <ListBox x:Name="rootCardList" Margin="-4,0,0,0"
                        ItemsSource="{Binding Player.Elements}"
                             ScrollViewer.VerticalScrollBarVisibility="Disabled"
                             SelectedItem="{Binding BattlefieldViewModel.FirstPlayerSelectedElement, Mode=TwoWay}" 
                             >
            		    <ListBox.ItemTemplate>
            			    <DataTemplate>
			                    <ListBox Margin="0,0,4,0"
			                             CacheMode="BitmapCache" 
									     ItemsSource="{Binding Cards}"
                                         SelectedItem="{Binding ElementName=rootCardList, Path=DataContext.BattlefieldViewModel.SelectedCard, Mode=TwoWay}"
			                             ItemTemplate="{StaticResource CardInBookDataTemplate}"
			                             ScrollViewer.VerticalScrollBarVisibility="Disabled">
			                        <ListBox.ItemsPanel>
			                            <ItemsPanelTemplate>
			                                <StackPanel Orientation="Horizontal"/>
			                            </ItemsPanelTemplate>
			                        </ListBox.ItemsPanel>
			                    </ListBox> 		
						    </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
            </Grid>


        </Grid>

    </Grid>
</UserControl>
