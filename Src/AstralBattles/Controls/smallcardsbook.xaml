<UserControl x:Class="AstralBattles.Controls.SmallCardsBook"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:Converters="clr-namespace:AstralBattles.Converters"
             xmlns:Controls="clr-namespace:AstralBattles.Controls"
             xmlns:ViewModels="clr-namespace:AstralBattles.ViewModels"
             xmlns:toolkit="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone.Controls.Toolkit"
             mc:Ignorable="d"
             x:Name="thisControl"
    d:DesignHeight="480" d:DesignWidth="725">
    <UserControl.Resources>


        <Converters:ElementsImageConverter x:Key="elementImageConverter"/>
        <Converters:CardImageConverter x:Key="cardImageConverter"/>
        <Converters:BindToElementConverter x:Key="bindToElementConverter" />
        <Converters:IsActiveToOpacityConverter x:Key="isActiveToOpacityConverter" />
        <Converters:NullToHiddenConverter x:Key="nullToHiddenConverter" />
        <Converters:TrueToVisibleConverter x:Key="trueToVisibleConverter" />
        <Converters:IsCreatureToVisible x:Key="isCreatureToVisible" />
        <Converters:FalseToVisibleConverter x:Key="falseToVisibleConverter" />

        <DataTemplate x:Key="ElementDataTemplate">
            <Controls:ElementInfo Element="{Binding}"></Controls:ElementInfo>
        </DataTemplate>

        <DataTemplate x:Key="CardInBookDataTemplate">
            <Grid Margin="1.5">
                <Grid VerticalAlignment="Center" HorizontalAlignment="Center" Width="145" Height="145">
                    <Image Margin="3"
        				   Source="{Binding Converter={StaticResource cardImageConverter}}" />


                    <Border Visibility="{Binding IsFake, Converter={StaticResource falseToVisibleConverter}}" 
                            VerticalAlignment="Top" HorizontalAlignment="Left" Background="#97494949" 
                            Margin="3,3,3,3" Height="19" Width="22" CornerRadius="0,0,5,0">
                        <TextBlock Label="{Binding Cost}" Margin="2,-3,2,0" 
								   VerticalAlignment="Center" HorizontalAlignment="Center" 
								   FontSize="17" Foreground="White"></TextBlock>
                    </Border>

                    <Border VerticalAlignment="Bottom" HorizontalAlignment="Left" 
                            Background="#97494949" Margin="3,3,3,3" Height="19"
                            Width="22" CornerRadius="0,5,0,0"
                            Visibility="{Binding ., Converter={StaticResource isCreatureToVisible}}">
                        <TextBlock Label="{Binding DamageString}" Margin="2,-3,2,0" 
								   VerticalAlignment="Center" HorizontalAlignment="Center" 
								   FontSize="17" Foreground="#FFFFF9CF"></TextBlock>
                    </Border>

                    <Border VerticalAlignment="Bottom" HorizontalAlignment="Right" Background="#97494949" 
                            Margin="3,3,3,3" Height="19" Width="22" CornerRadius="5,0,0,0"
                            Visibility="{Binding ., Converter={StaticResource isCreatureToVisible}}">
                        <TextBlock Label="{Binding Health}" Margin="2,-3,2,0" 
								   VerticalAlignment="Center" HorizontalAlignment="Center" 
								   FontSize="17" Foreground="#FF9DFF71"></TextBlock>
                    </Border>

                    <Border x:Name="cardInBookBorder" Margin="3" Opacity="{Binding IsActive, Converter={StaticResource isActiveToOpacityConverter}}" Background="#5E5E5E"/>

                    <Rectangle x:Name="rootRectangle" Stroke ="White" StrokeThickness ="2" 
                            StrokeDashArray="0.5,2" StrokeDashCap="Square"
                            Visibility="{Binding IsSelected, Converter={StaticResource trueToVisibleConverter}}">
                        <Rectangle.Triggers>
                            <EventTrigger RoutedEvent="Rectangle.Loaded">
                                <EventTrigger.Actions >
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation 
                                                 Storyboard.TargetName="rootRectangle"
                                                 Storyboard.TargetProperty="StrokeDashOffset"
                                                 To="20" Duration="0:0:30"
                                                 RepeatBehavior="Forever" />
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger.Actions>
                            </EventTrigger>
                        </Rectangle.Triggers>
                    </Rectangle>

                </Grid>
            </Grid>
        </DataTemplate>
        
    </UserControl.Resources>

    <Grid x:Name="LayoutRoot"
          DataConLabel="{Binding ElementName=thisControl}"
          d:DataConLabel="{d:DesignInstance Type=ViewModels:DesignTimeDataContext, IsDesignTimeCreatable=True}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="145"/>
            <ColumnDefinition Width="145"/>
            <ColumnDefinition Width="145"/>
            <ColumnDefinition Width="145"/>
            <ColumnDefinition Width="145" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition />
        </Grid.RowDefinitions>

        <Controls:ElementInfo Grid.Column="0" Element="{Binding Player.Elements[0]}"></Controls:ElementInfo>
        <ListBox Grid.Column="0" Grid.Row="1" ItemsSource="{Binding Player.Elements[0].Cards}" ItemTemplate="{StaticResource CardInBookDataTemplate}">
            <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                    <toolkit:WrapPanel Orientation="Horizontal"/>
                </ItemsPanelTemplate>
            </ListBox.ItemsPanel>
        </ListBox>

        <Controls:ElementInfo Grid.Column="1" Element="{Binding Player.Elements[1]}"></Controls:ElementInfo>
        <ListBox Grid.Column="1" Grid.Row="1" ItemsSource="{Binding Player.Elements[1].Cards}" ItemTemplate="{StaticResource CardInBookDataTemplate}">
            <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                    <toolkit:WrapPanel Orientation="Horizontal"/>
                </ItemsPanelTemplate>
            </ListBox.ItemsPanel>
        </ListBox>

        <Controls:ElementInfo Grid.Column="2" Element="{Binding Player.Elements[2]}"></Controls:ElementInfo>
        <ListBox Grid.Column="2" Grid.Row="1" ItemsSource="{Binding Player.Elements[2].Cards}" ItemTemplate="{StaticResource CardInBookDataTemplate}">
            <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                    <toolkit:WrapPanel Orientation="Horizontal"/>
                </ItemsPanelTemplate>
            </ListBox.ItemsPanel>
        </ListBox>

        <Controls:ElementInfo Grid.Column="3" Element="{Binding Player.Elements[3]}"></Controls:ElementInfo>
        <ListBox Grid.Column="3" Grid.Row="1" ItemsSource="{Binding Player.Elements[3].Cards}" ItemTemplate="{StaticResource CardInBookDataTemplate}">
            <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                    <toolkit:WrapPanel Orientation="Horizontal"/>
                </ItemsPanelTemplate>
            </ListBox.ItemsPanel>
        </ListBox>

        <Controls:ElementInfo Grid.Column="4" Element="{Binding Player.Elements[4]}"></Controls:ElementInfo>
        <ListBox Grid.Column="4" Grid.Row="1" ItemsSource="{Binding Player.Elements[4].Cards}" ItemTemplate="{StaticResource CardInBookDataTemplate}">
            <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                    <toolkit:WrapPanel Orientation="Horizontal"/>
                </ItemsPanelTemplate>
            </ListBox.ItemsPanel>
        </ListBox>
        
    </Grid>
</UserControl>
