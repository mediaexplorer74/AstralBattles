<UserControl x:Class="AstralBattles.Controls.DeckFieldBorder"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:Converters="clr-namespace:AstralBattles.Converters" mc:Ignorable="d" x:Name="thisControl"
    d:DesignHeight="120" d:DesignWidth="120">

    <UserControl.Resources>


        <Converters:ElementsImageConverter x:Key="elementImageConverter"/>
        <Converters:CardImageConverter x:Key="cardImageConverter"/>
        <Converters:BindToElementConverter x:Key="bindToElementConverter" />
        <Converters:IsActiveToOpacityConverter x:Key="isActiveToOpacityConverter" />
        <Converters:NullToHiddenConverter x:Key="nullToHiddenConverter" />
        <Converters:TrueToVisibleConverter x:Key="trueToVisibleConverter" />
        <Converters:IsCreatureToVisible x:Key="isCreatureToVisible" />
        <Converters:FalseToVisibleConverter x:Key="falseToVisibleConverter" />
    </UserControl.Resources>

    <Grid x:Name="LayoutRoot" DataContext="{Binding ElementName=thisControl}">
        <Grid.Background>
            <ImageBrush ImageSource="/AstralBattles;component/Resources/Backgrounds/titanium-texture.jpg"/>
        </Grid.Background>

        <Image Margin="5" Source="{Binding Path=DeckCard.Card, Converter={StaticResource cardImageConverter}}"/>

        <Border Visibility="{Binding DeckCard.Card, Converter={StaticResource nullToHiddenConverter}}" 
                                VerticalAlignment="Top" HorizontalAlignment="Left" Background="#97494949" 
                                Margin="0" Height="30" Width="30" CornerRadius="0,0,5,0">
            <TextBlock Text="{Binding DeckCard.Card.Cost}" Margin="2,0,2,0" 
								       VerticalAlignment="Center" HorizontalAlignment="Center" 
								       FontSize="22" Foreground="White"></TextBlock>
        </Border>

        <Border VerticalAlignment="Bottom" HorizontalAlignment="Left" 
                                Background="#97494949" Margin="0" Height="30"
                                Width="30" CornerRadius="0,5,0,0"
                                Visibility="{Binding DeckCard.Card, Converter={StaticResource isCreatureToVisible}}">
            <TextBlock Text="{Binding DeckCard.Card.DamageString}" Margin="2,0,2,0" 
								       VerticalAlignment="Center" HorizontalAlignment="Center" 
								       FontSize="22" Foreground="#FFFFF9CF"></TextBlock>
        </Border>

        <Border VerticalAlignment="Bottom" HorizontalAlignment="Right" Background="#97494949" 
                                Margin="0" Height="30" Width="30" CornerRadius="5,0,0,0"
                                Visibility="{Binding DeckCard.Card, Converter={StaticResource isCreatureToVisible}}">
            <TextBlock Text="{Binding DeckCard.Card.Health}" Margin="2,0,2,0" 
								       VerticalAlignment="Center" HorizontalAlignment="Center" 
								       FontSize="22" Foreground="#FF9DFF71"></TextBlock>
        </Border>



        <Rectangle x:Name="rootRectangle" Stroke ="White" StrokeThickness ="2" 
                            StrokeDashArray="0.5,2" StrokeDashCap="Square"
                            Visibility="{Binding DeckCard.IsSelected, Converter={StaticResource trueToVisibleConverter}}">
            <Rectangle.Triggers>
                <EventTrigger RoutedEvent="Rectangle.Loaded">
                    <EventTrigger.Actions >
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation 
                                                 Storyboard.TargetName="rootRectangle"
                                                 Storyboard.TargetProperty="StrokeDashOffset"
                                                 To="20" Duration="0:0:30"
                                                 RepeatBehavior="Forever" />
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger.Actions>
                </EventTrigger>
            </Rectangle.Triggers>
        </Rectangle>
        <Rectangle x:Name="waitSelectRectangle" Stroke ="#FFABABAB" StrokeThickness="10" 
                   StrokeDashArray="0.5,2"
                   Visibility="{Binding DeckCard.IsWaitingForChoise, Converter={StaticResource trueToVisibleConverter}}" Margin="-3" StrokeDashCap="Square">
            <Rectangle.Triggers>
                <EventTrigger RoutedEvent="Rectangle.Loaded">
                    <EventTrigger.Actions >
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation 
                                     Storyboard.TargetName="waitSelectRectangle"
                                     Storyboard.TargetProperty="StrokeDashOffset"
                                     To="20" Duration="0:0:5"
                                     RepeatBehavior="Forever" />
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger.Actions>
                </EventTrigger>
            </Rectangle.Triggers>
        </Rectangle>

    </Grid>
</UserControl>
