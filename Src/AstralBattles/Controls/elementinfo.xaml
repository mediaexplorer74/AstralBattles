<UserControl x:Class="AstralBattles.Controls.ElementInfo"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:Converters="clr-namespace:AstralBattles.Converters" 
    xmlns:ViewModels="clr-namespace:AstralBattles.ViewModels"
    mc:Ignorable="d"
    FontFamily="{StaticResource PhoneFontFamilyNormal}"
    FontSize="{StaticResource PhoneFontSizeNormal}"
    Foreground="White"
    Height="34"
    x:Name="control"
    Loaded="UserControlLoaded"
    d:DataContext="{d:DesignInstance Type=ViewModels:DesignTimeDataContext, IsDesignTimeCreatable=True}">
    
    <UserControl.Resources>
        <Converters:ElementsImageConverter x:Key="elementImageConverter"/>
        <Converters:TrueToGrayColorConverter x:Key="toGrayConverter" />
        <Converters:FalseToVisibleConverter x:Key="falseToVisibleConverter" />
        <Converters:ElementTextConverter x:Key="elementTextConverter" />
    </UserControl.Resources>

    <Grid x:Name="LayoutRoot" Background="{Binding IsSelected, Converter={StaticResource toGrayConverter}}">
    	<VisualStateManager.VisualStateGroups>
    		<VisualStateGroup x:Name="VisualStateGroup">
    			<VisualStateGroup.Transitions>
    				<VisualTransition GeneratedDuration="0" To="ManaDecreased">
    					<Storyboard x:Name="manaDecreasedStoryboard">
    						<PointAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransformOrigin)" Storyboard.TargetName="border">
    							<EasingPointKeyFrame KeyTime="0" Value="0,0"/>
    							<EasingPointKeyFrame KeyTime="0:0:0.5" Value="0,0.4705810546875"/>
    							<EasingPointKeyFrame KeyTime="0:0:1" Value="0,1"/>
    						</PointAnimationUsingKeyFrames>
    						<DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Projection).(PlaneProjection.LocalOffsetZ)" Storyboard.TargetName="border">
    							<EasingDoubleKeyFrame KeyTime="0" Value="0"/>
    							<EasingDoubleKeyFrame KeyTime="0:0:0.5" Value="-200"/>
    							<EasingDoubleKeyFrame KeyTime="0:0:1" Value="0"/>
                            </DoubleAnimationUsingKeyFrames>
                            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Opacity)" Storyboard.TargetName="border1">
                                <EasingDoubleKeyFrame KeyTime="0" Value="0"/>
                                <EasingDoubleKeyFrame KeyTime="0:0:1" Value="1"/>
                                <EasingDoubleKeyFrame KeyTime="0:0:2" Value="0"/>
                            </DoubleAnimationUsingKeyFrames>
                            <ColorAnimationUsingKeyFrames Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)" Storyboard.TargetName="border">
    							<EasingColorKeyFrame KeyTime="0" Value="#FFE7E7E7"/>
    							<EasingColorKeyFrame KeyTime="0:0:0.5" Value="#FEFF4629"/>
    							<EasingColorKeyFrame KeyTime="0:0:1" Value="#FFE7E7E7"/>
    						</ColorAnimationUsingKeyFrames>
    					</Storyboard>
                    </VisualTransition>
                    <VisualTransition GeneratedDuration="0" To="ManaIncreased">
                        <Storyboard x:Name="manaIncreasedStoryboard">
                            <PointAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransformOrigin)" Storyboard.TargetName="border">
                                <EasingPointKeyFrame KeyTime="0" Value="0,0"/>
                                <EasingPointKeyFrame KeyTime="0:0:0.5" Value="0,0.4705810546875"/>
                                <EasingPointKeyFrame KeyTime="0:0:1" Value="0,1"/>
                            </PointAnimationUsingKeyFrames>
                            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Projection).(PlaneProjection.LocalOffsetZ)" Storyboard.TargetName="border">
                                <EasingDoubleKeyFrame KeyTime="0" Value="0"/>
                                <EasingDoubleKeyFrame KeyTime="0:0:0.5" Value="200"/>
                                <EasingDoubleKeyFrame KeyTime="0:0:1" Value="0"/>
                            </DoubleAnimationUsingKeyFrames>
                            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Opacity)" Storyboard.TargetName="border1">
                                <EasingDoubleKeyFrame KeyTime="0" Value="0"/>
                                <EasingDoubleKeyFrame KeyTime="0:0:1" Value="1"/>
                                <EasingDoubleKeyFrame KeyTime="0:0:2" Value="0"/>
                            </DoubleAnimationUsingKeyFrames>
                            <ColorAnimationUsingKeyFrames Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)" Storyboard.TargetName="border">
                                <EasingColorKeyFrame KeyTime="0" Value="#FFE7E7E7"/>
                                <EasingColorKeyFrame KeyTime="0:0:0.5" Value="#FE00D529"/>
                                <EasingColorKeyFrame KeyTime="0:0:1" Value="#FFE7E7E7"/>
                            </ColorAnimationUsingKeyFrames>
                        </Storyboard>
                    </VisualTransition>
                </VisualStateGroup.Transitions>
    			<VisualState x:Name="Default"/>
                <VisualState x:Name="ManaDecreased">
                </VisualState>
                <VisualState x:Name="ManaIncreased">
                </VisualState>
                <VisualState x:Name="Selected">
                	<Storyboard>
                		<ColorAnimation Duration="0" To="#FF313131" Storyboard.TargetProperty="(Panel.Background).(SolidColorBrush.Color)" Storyboard.TargetName="LayoutRoot" d:IsOptimized="True"/>
                	</Storyboard>
                </VisualState>
            </VisualStateGroup>
    	</VisualStateManager.VisualStateGroups>
        <StackPanel x:Name="stackPanel"
                    DataContext="{Binding ElementName=control}"
                    Orientation="Horizontal" 
                    Margin="0,3,0,3">
            <Image Source="{Binding Element.ElementType, Converter={StaticResource elementImageConverter}}" 
                   Height="28" 
                   Width="28" 
                   Margin="4,0,0,0" />
            <TextBlock x:Name="textBlock" 
                       Text="{Binding Element.ElementType, Converter={StaticResource elementTextConverter}}" 
                       Width="75"
                       Visibility="{Binding HideName, Converter={StaticResource falseToVisibleConverter}}"
                       Margin="4,1,3,-3" 
                       FontSize="16" />
            <Border x:Name="border" Margin="0,0,3,0" 
                    Width="28" 
                    Height="28" 
                    Background="#FFE7E7E7">
            	<Border.Projection>
            		<PlaneProjection/>
            	</Border.Projection>
                <TextBlock Text="{Binding Element.Mana}" 
                           Foreground="Black" 
                           FontWeight="Bold" 
                           VerticalAlignment="Center" 
                           HorizontalAlignment="Center" 
                           Margin="0,0,0,3"/>
            </Border>
        </StackPanel>

        <Border Canvas.ZIndex="1000" x:Name="border1" Margin="0,0,30,0"
                    Width="Auto" 
                    Height="28" 
                    Opacity="0" RenderTransformOrigin="0.5,0.5" 
                    DataContext="{Binding ElementName=control}"
                    HorizontalAlignment="Right" Background="White"
                    >
            <TextBlock x:Name="overflowTextBox" Text="{Binding OverflowText}" 
                           Margin="3,-3,3,0"
                           Foreground="Green" 
                           FontWeight="Bold" 
                           VerticalAlignment="Center" 
                           HorizontalAlignment="Center">
            </TextBlock>
            <Border.RenderTransform>
                <CompositeTransform/>
            </Border.RenderTransform>
        </Border>
    </Grid>
</UserControl>
